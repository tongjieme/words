<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Nodejs 使用Pug.js 实现多语言应用 · Tong Jiewen</title><meta name="description" content="Nodejs 使用Pug.js 实现多语言应用 - Tong Jiewen"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.jpg"><link rel="stylesheet" href="/css/apollo.css"><!-- - var xml = config.url + '/atom.xml'//- link(rel="search", type="application/opensearchdescription+xml", href=xml, title=config.title)--></head><body><div class="wrap"><header><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/tongjieme" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/qr.html" target="_self" class="nav-list-link">QRCODE</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">Nodejs 使用Pug.js 实现多语言应用</h1><div class="post-info">Jan 26, 2017</div><div class="post-content"><p>Pug.js(jade) 是一款非常简洁且高性能的模板引擎, 可用于Nodejs和浏览器, 此文介绍如何使用它在nodejs环境下实现多语言访问</p>
<p>首先体验一下其简洁的语法:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">doctype html</div><div class="line">html(lang=&quot;en&quot;)</div><div class="line">  head</div><div class="line">    title= pageTitle</div><div class="line">    script(type=&apos;text/javascript&apos;).</div><div class="line">      if (foo) bar(1 + 5)</div><div class="line">  body</div><div class="line">    h1 Pug - node template engine</div><div class="line">    #container.col</div><div class="line">      if youAreUsingPug</div><div class="line">        p You are amazing</div><div class="line">      else</div><div class="line">        p Get on it!</div><div class="line">      p.</div><div class="line">        Pug is a terse and simple templating language with a</div><div class="line">        strong focus on performance and powerful features.</div></pre></td></tr></table></figure></p>
<p>转化成<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Pug<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></div><div class="line">      if (foo) bar(1 + 5)</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Pug - node template engine<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"container"</span> <span class="attr">class</span>=<span class="string">"col"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>You are amazing<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>Pug is a terse and simple templating language with a strong focus on performance and powerful features.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>以下介绍如何实现多语言功能</p>
<h3 id="安装-express-pug-locale-及创建文件树"><a href="#安装-express-pug-locale-及创建文件树" class="headerlink" title="安装 express pug locale 及创建文件树"></a>安装 express pug locale 及创建文件树</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> your_project</div><div class="line">npm i express pug locale --save</div><div class="line">touch app.js</div><div class="line">mkdir views</div><div class="line">touch zh-cn.json</div><div class="line">touch en-us.json</div></pre></td></tr></table></figure>
<p>以下为最终的文件树<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">tree -I <span class="string">'node_modules'</span></div><div class="line">.</div><div class="line">├── app.js</div><div class="line">├── lang</div><div class="line">│   ├── en-us.json</div><div class="line">│   └── zh-cn.json</div><div class="line">├── package.json</div><div class="line">└── views</div><div class="line">    └── index.pug</div></pre></td></tr></table></figure></p>
<h2 id="集成到express"><a href="#集成到express" class="headerlink" title="集成到express"></a>集成到express</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</div><div class="line"><span class="keyword">var</span> app = express();</div><div class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</div><div class="line"></div><div class="line">app.set(<span class="string">'view engine'</span>, <span class="string">'pug'</span>);</div><div class="line"></div><div class="line">app.listen(<span class="number">3333</span>, () =&gt; &#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'Example app listening on port 3333!'</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h2 id="语言相关配置"><a href="#语言相关配置" class="headerlink" title="语言相关配置"></a>语言相关配置</h2><p>app.js<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> locale = <span class="built_in">require</span>(<span class="string">"locale"</span>);</div><div class="line"></div><div class="line">app.use(locale([<span class="string">'en-us'</span>, <span class="string">'zh-cn'</span>]));</div><div class="line">locale.Locale[<span class="string">"default"</span>] = <span class="string">'en-us'</span>;</div></pre></td></tr></table></figure></p>
<p>lang/zh-cn.json<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"Home"</span>: <span class="string">"首页"</span>,</div><div class="line">  <span class="attr">"Services"</span>: <span class="string">"服务"</span>,</div><div class="line">  <span class="attr">"Products"</span>: <span class="string">"产品"</span>,</div><div class="line">  <span class="attr">"About_us"</span>: <span class="string">"关于我们"</span>,</div><div class="line">  <span class="attr">"Contact_us"</span>: <span class="string">"联系我们"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>lang/zh-cn.json<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"Home"</span>: <span class="string">"Home"</span>,</div><div class="line">  <span class="attr">"Services"</span>: <span class="string">"Services"</span>,</div><div class="line">  <span class="attr">"Products"</span>: <span class="string">"Products"</span>,</div><div class="line">  <span class="attr">"About_us"</span>: <span class="string">"About us"</span>,</div><div class="line">  <span class="attr">"Contact_us"</span>: <span class="string">"Contact_us"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="加载语言文件"><a href="#加载语言文件" class="headerlink" title="加载语言文件"></a>加载语言文件</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> lang = &#123;&#125;;</div><div class="line">fs.readdirSync(<span class="string">`<span class="subst">$&#123;__dirname&#125;</span>/lang`</span>).forEach(<span class="function"><span class="params">file</span> =&gt;</span> &#123;</div><div class="line">  <span class="keyword">if</span>(file.indexOf(<span class="string">'.'</span>) !== <span class="number">0</span>) &#123;</div><div class="line">    <span class="comment">// 忽略 . 开头的文件</span></div><div class="line">    <span class="keyword">var</span> language_flag = file.split(<span class="string">'.'</span>)[<span class="number">0</span>];</div><div class="line">    lang[language_flag] = <span class="built_in">JSON</span>.parse(fs.readFileSync(<span class="string">`<span class="subst">$&#123;__dirname&#125;</span>/lang/<span class="subst">$&#123;file&#125;</span>`</span>));</div><div class="line">  &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h2 id="动态识别用户当前环境"><a href="#动态识别用户当前环境" class="headerlink" title="动态识别用户当前环境"></a>动态识别用户当前环境</h2><p>由于使用locale包, 识别用户语言环境变得相当简单<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">app.get(<span class="string">'/'</span>, (req, res) =&gt; &#123;</div><div class="line">  req.locale <span class="comment">// locale 已经根据用户语言环境与本应用支持的语言衡量出最佳匹配语言</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<h2 id="渲染相应语言html"><a href="#渲染相应语言html" class="headerlink" title="渲染相应语言html"></a>渲染相应语言html</h2><p>app.js<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">app.get(<span class="string">'/'</span>, (req, res) =&gt; &#123;</div><div class="line">  res.render(<span class="string">'index'</span>, lang[req.locale])</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>index.pug<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">html</div><div class="line">  head</div><div class="line">    meta(charset=&quot;utf-8&quot;)</div><div class="line">  body</div><div class="line">    ul</div><div class="line">      li= Home</div><div class="line">      li= Services</div><div class="line">      li= Products</div><div class="line">      li= About_us</div><div class="line">      li= Contact_us</div></pre></td></tr></table></figure></p>
<h2 id="完整的app-js-代码"><a href="#完整的app-js-代码" class="headerlink" title="完整的app.js 代码"></a>完整的app.js 代码</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</div><div class="line"><span class="keyword">var</span> app = express();</div><div class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</div><div class="line"><span class="keyword">var</span> locale = <span class="built_in">require</span>(<span class="string">"locale"</span>);</div><div class="line"></div><div class="line">app.use(locale([<span class="string">'en-us'</span>, <span class="string">'zh-cn'</span>]));</div><div class="line">locale.Locale[<span class="string">"default"</span>] = <span class="string">'en-us'</span>;</div><div class="line"></div><div class="line">app.set(<span class="string">'view engine'</span>, <span class="string">'pug'</span>);</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">var</span> lang = &#123;&#125;;</div><div class="line">fs.readdirSync(<span class="string">`<span class="subst">$&#123;__dirname&#125;</span>/lang`</span>).forEach(<span class="function"><span class="params">file</span> =&gt;</span> &#123;</div><div class="line">  <span class="keyword">if</span>(file.indexOf(<span class="string">'.'</span>) !== <span class="number">0</span>) &#123;</div><div class="line">    <span class="comment">// 忽略 . 开头的文件</span></div><div class="line">    <span class="keyword">var</span> language_flag = file.split(<span class="string">'.'</span>)[<span class="number">0</span>];</div><div class="line">    lang[language_flag] = <span class="built_in">JSON</span>.parse(fs.readFileSync(<span class="string">`<span class="subst">$&#123;__dirname&#125;</span>/lang/<span class="subst">$&#123;file&#125;</span>`</span>));</div><div class="line">  &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line">app.get(<span class="string">'/'</span>, (req, res) =&gt; &#123;</div><div class="line">  res.render(<span class="string">'index'</span>, lang[req.locale])</div><div class="line">&#125;);</div><div class="line"></div><div class="line"></div><div class="line">app.listen(<span class="number">3333</span>, () =&gt; &#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'Example app listening on port 3333!'</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>最终的文件树<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">tree -I <span class="string">'node_modules'</span></div><div class="line">.</div><div class="line">├── app.js</div><div class="line">├── lang</div><div class="line">│   ├── en-us.json</div><div class="line">│   └── zh-cn.json</div><div class="line">├── package.json</div><div class="line">└── views</div><div class="line">    └── index.pug</div></pre></td></tr></table></figure></p>
<h2 id="最终效果"><a href="#最终效果" class="headerlink" title="最终效果"></a>最终效果</h2><p><img src="/img/pug_multi_language.png" alt="pug_multi_language"></p>
<h4 id="附常见几款模板引擎性能对比-Table"><a href="#附常见几款模板引擎性能对比-Table" class="headerlink" title="附常见几款模板引擎性能对比 Table"></a>附常见几款模板引擎性能对比 Table</h4><table>
<thead>
<tr>
<th>Template</th>
<th>Syntax</th>
<th>Streaming</th>
<th>Asynchronous</th>
<th>Auto-escape</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/linkedin/dustjs" target="_blank" rel="external">dustjs-linkedin</a></td>
<td>Text</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
</tr>
<tr>
<td><a href="https://github.com/olado/doT" target="_blank" rel="external">doT</a></td>
<td>Text</td>
<td>✖</td>
<td>✖</td>
<td>✖</td>
</tr>
<tr>
<td><a href="https://github.com/wycats/handlebars.js" target="_blank" rel="external">handlebars</a></td>
<td>Text</td>
<td>✖</td>
<td>✖</td>
<td>✔</td>
</tr>
<tr>
<td><a href="https://github.com/pugjs/pug" target="_blank" rel="external">pug</a></td>
<td>Short-hand HTML</td>
<td>✖</td>
<td>✖</td>
<td>✔</td>
</tr>
<tr>
<td><a href="https://github.com/marko-js/marko" target="_blank" rel="external">marko</a></td>
<td>HTML/Concise HTML</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
</tr>
<tr>
<td><a href="http://mozilla.github.io/nunjucks/" target="_blank" rel="external">nunjucks</a></td>
<td>Text</td>
<td>✖</td>
<td>✔</td>
<td>✖</td>
</tr>
<tr>
<td><a href="https://facebook.github.io/react/" target="_blank" rel="external">react</a><sup>1</sup></td>
<td>JSX</td>
<td>✖</td>
<td>✖</td>
<td>✔</td>
</tr>
<tr>
<td><a href="http://mozilla.github.io/nunjucks/" target="_blank" rel="external">swig</a></td>
<td>Text</td>
<td>✖</td>
<td>✖</td>
<td>✔</td>
</tr>
</tbody>
</table>
<p>性能对比资料来源: <a href="https://github.com/marko-js/templating-benchmarks/" target="_blank" rel="external">templating-benchmarks</a></p>
</div></article></div></section><footer><div class="paginator"><a href="/2017/03/15/MySQL 的储存引擎/" class="prev">上一篇</a><a href="/2017/01/22/在mac上使用SSH key 自动且安全地登录远程Linux服务器/" class="next">下一篇</a></div></footer></div></body></html>
<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 在Mac上使用SSH key 自动且安全地登录远程Linux服务器 · Tong Jiewen</title><meta name="description" content="在Mac上使用SSH key 自动且安全地登录远程Linux服务器 - Tong Jiewen"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.jpg"><link rel="stylesheet" href="/css/apollo.css"><!-- - var xml = config.url + '/atom.xml'//- link(rel="search", type="application/opensearchdescription+xml", href=xml, title=config.title)--></head><body><div class="wrap"><header><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/tongjieme" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/qr.html" target="_self" class="nav-list-link">QRCODE</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">在Mac上使用SSH key 自动且安全地登录远程Linux服务器</h1><div class="post-info">Jan 22, 2017</div><div class="post-content"><p>通常登陆远程Linux经常需要输入密码, 频繁输入密码比较低效率且有被暴力破解的风险, SSH key提供了免密码且更加安全登陆服务器的方法,以下为设置过程</p>
<h2 id="生成私钥和公钥"><a href="#生成私钥和公钥" class="headerlink" title="生成私钥和公钥"></a>生成私钥和公钥</h2><p>在终端输入<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ssh-keygen -t rsa</div></pre></td></tr></table></figure></p>
<p>输入生成地址及使用口令 可选择性回车跳过<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Enter file <span class="keyword">in</span> <span class="built_in">which</span> to save the key (/home/demo/.ssh/id_rsa):</div><div class="line">Enter passphrase (empty <span class="keyword">for</span> no passphrase):</div></pre></td></tr></table></figure></p>
<p>终端生成过程类似这样<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">ssh-keygen -t rsa</div><div class="line">Generating public/private rsa key pair.</div><div class="line">Enter file <span class="keyword">in</span> <span class="built_in">which</span> to save the key (/home/demo/.ssh/id_rsa): </div><div class="line">Enter passphrase (empty <span class="keyword">for</span> no passphrase): </div><div class="line">Enter same passphrase again: </div><div class="line">Your identification has been saved <span class="keyword">in</span> /home/demo/.ssh/id_rsa.</div><div class="line">Your public key has been saved <span class="keyword">in</span> /home/demo/.ssh/id_rsa.pub.</div><div class="line">The key fingerprint is:</div><div class="line">4a:dd:0a:c6:35:4e:3f:ed:27:38:8c:74:44:4d:93:67 demo@a</div><div class="line">The key<span class="string">'s randomart image is:</span></div><div class="line">+--[ RSA 2048]----+</div><div class="line">|          .oo.   |</div><div class="line">|         .  o.E  |</div><div class="line">|        + .  o   |</div><div class="line">|     . = = .     |</div><div class="line">|      = S = .    |</div><div class="line">|     o + = +     |</div><div class="line">|      . o + o .  |</div><div class="line">|           . o   |</div><div class="line">|                 |</div><div class="line">+-----------------+</div></pre></td></tr></table></figure></p>
<p>这样就生成了 id_rsa(private key 私钥) 和 id_rsa.pub (public key 公钥)</p>
<h2 id="存放私钥和公钥"><a href="#存放私钥和公钥" class="headerlink" title="存放私钥和公钥"></a>存放私钥和公钥</h2><p>id_rsa 存放在客户端电脑, 存放路径为 ~/demo/.ssh/id_rsa<br>id_rsa.pub 存放在服务端, 存放路径为 ~/demo/.ssh/authorized_keys<br>使用SSH命令可以便捷地自动复制公钥到远程服务端<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cat ~/.ssh/id_rsa.pub | ssh user@123.45.56.78 <span class="string">"mkdir -p ~/.ssh &amp;&amp; cat &gt;&gt;  ~/.ssh/authorized_keys"</span></div></pre></td></tr></table></figure></p>
<h3 id="Tips"><a href="#Tips" class="headerlink" title="Tips"></a>Tips</h3><p>多个公钥可以同时存放在服务器的 ~/demo/.ssh/authorized_keys 文件里, 以换行符隔开即可</p>
<h2 id="完成"><a href="#完成" class="headerlink" title="完成"></a>完成</h2><p>至此, 已经可以顺利自动登录远程服务器<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">James:Desktop jackwin$ ssh demo@123.456.1.1 </div><div class="line">Last login: Sun Jan 22 02:56:18 2017 from 183.1.1.1</div><div class="line">[demo@instance-11 ~]$</div></pre></td></tr></table></figure></p>
<h3 id="问题排除"><a href="#问题排除" class="headerlink" title="问题排除"></a>问题排除</h3><p>比较常见的问题一般为权限设置, 一定要确保客户端和服务端的密钥文件及其文件夹是可被 SSH 进程可阅读的<br>如有需要可通过以下命令修改权限<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">chmod 755 authorized_keys</div><div class="line">chmod 700 id_rsa</div><div class="line">chmod 700 id_rsa.pub</div></pre></td></tr></table></figure></p>
<h4 id="示例"><a href="#示例" class="headerlink" title="示例:"></a>示例:</h4><p>服务端<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">demo@instance-11 .ssh]$ ls -lah</div><div class="line">total 12K</div><div class="line">drwx------. 2 demo demo 4.0K Jan 22 02:52 .</div><div class="line">drwxr-xr-x. 4 demo demo 4.0K Jan  8 16:21 ..</div><div class="line">-rwxr-xr-x. 1 demo demo  394 Jan 22 02:53 authorized_keys</div></pre></td></tr></table></figure></p>
<p>客户端<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">James:Desktop jackwin$ ls -lah ~/.ssh</div><div class="line">total 72</div><div class="line">drwx------   7 jackwin  staff   238B Jun 22  2015 .</div><div class="line">drwxr-xr-x@ 90 jackwin  staff   3.0K Jan 22 10:16 ..</div><div class="line">-rw-------@  1 jackwin  staff   1.6K May  4  2015 id_rsa</div><div class="line">-rw-r--r--   1 jackwin  staff   394B Jun 14  2015 id_rsa.pub</div><div class="line">-rw-r--r--@  1 jackwin  staff    18K Jan 22 10:50 known_hosts</div></pre></td></tr></table></figure></p>
</div></article></div></section><footer><div class="paginator"><a href="/2017/01/26/Nodejs 使用PugJs 实现多语言应用/" class="prev">上一篇</a><a href="/2017/01/19/使用linux crontab 定时运行任务/" class="next">下一篇</a></div></footer></div></body></html>